(this["webpackJsonpeta-react"]=this["webpackJsonpeta-react"]||[]).push([[0],{42:function(t,e,a){},65:function(t,e,a){"use strict";a.r(e);var n=a(16),o=a(12),s=a(15),r=a(13),c=a(22),i=a(21),l=a(0),u=a.n(l),d=a(11),p=a.n(d),b=(a(42),a(29)),h=a(105),f=a(106),j=a(107),g=a(5),O=function(t){Object(c.a)(a,t);var e=Object(i.a)(a);function a(t){var n;return Object(s.a)(this,a),(n=e.call(this,t)).state={showRoutes:[],showStops:[],selectedRouteValue:null,selectedStopValue:null},n}return Object(r.a)(a,[{key:"componentDidMount",value:function(){var t=[];console.log("loading"),Object.entries(this.props.routes).forEach((function(e){var a=e[1],n=a.route+" : "+a.orig_tc+" -> "+a.dest_tc;t.push({value:a,label:n})})),this.setState({showRoutes:t},(function(){console.log("loading end")}))}},{key:"render",value:function(){var t=this;return Object(g.jsxs)("div",{children:[Object(g.jsx)(j.a,{options:this.state.showRoutes,getOptionLabel:function(t){return t.label},renderInput:function(t){return Object(g.jsx)(f.a,Object(b.a)(Object(b.a)({},t),{},{label:"Route",variant:"outlined"}))},onChange:function(e,a){!function(e){var a=[],n=e.value;t.props.mappings[n.route+"&"+n.bound].forEach((function(e){var n=t.props.stops[e.stop];a.push({label:n.name_tc,value:n})})),t.setState({showStops:a,selectedStopValue:null,selectedRouteValue:e})}(a)},value:this.state.selectedRouteValue}),Object(g.jsx)(j.a,{options:this.state.showStops,getOptionLabel:function(t){return t.label},renderInput:function(t){return Object(g.jsx)(f.a,Object(b.a)(Object(b.a)({},t),{},{label:"Stop",variant:"outlined"}))},onChange:function(e,a){!function(e){t.setState({selectedStopValue:e})}(a)},value:this.state.selectedStopValue}),Object(g.jsx)(h.a,{disabled:null===this.state.selectedRouteValue||null===this.state.selectedStopValue,style:{width:"100%"},variant:"outlined",onClick:function(e){t.props.addTrack(t.state.selectedRouteValue.value,t.state.selectedStopValue.value),t.setState({selectedRouteValue:null,selectedStopValue:null})},children:"Add"})]})}}]),a}(u.a.Component),v=function(t){Object(c.a)(a,t);var e=Object(i.a)(a);function a(t){var n;return Object(s.a)(this,a),(n=e.call(this,t)).state={etas:[]},n}return Object(r.a)(a,[{key:"componentDidMount",value:function(){var t=this,e=function(){fetch(t.props.track.url).then((function(t){return t.json()})).then((function(e){var a=e.data,n=[],o=Date.now();a.forEach((function(e){if(e.dir===t.props.track.bound){var a=Math.round((new Date(e.eta)-o)/1e3/60);a>=0&&n.push(a)}})),0===n.length&&n.push("no car"),t.setState({etas:n})}))};e(),setInterval((function(){e()}),1e4)}},{key:"render",value:function(){var t=this;return Object(g.jsxs)("div",{onContextMenu:function(){t.props.removeTrack(t.props.track.url)},style:{fontSize:"10px",marginBottom:"10px",borderRadius:"12px",aspectRatio:"4/1",width:"100%",maxWidth:"12cm",backgroundColor:"lightsteelblue",display:"flex",flexDirection:"row"},children:[" ",Object(g.jsx)("div",{style:{width:"20%",margin:"2.5%",backgroundColor:"lightgray",borderRadius:"50%",aspectRatio:"1/1",display:"flex",justifyContent:"center",alignItems:"center"},children:Object(g.jsx)("div",{style:{padding:"10%",fontSize:"1.5em"},children:this.props.track.route})}),Object(g.jsxs)("div",{style:{width:"75%",aspectRatio:"3/1"},children:[Object(g.jsx)("div",{style:{aspectRatio:"6/1",display:"flex",justifyContent:"center",alignItems:"center"},children:Object(g.jsx)("div",{style:{fontSize:"1.3em"},children:this.props.track.orig+" -> "+this.props.track.dest})}),Object(g.jsxs)("div",{style:{aspectRatio:"6/1",display:"flex",alignItems:"center",flexDirection:"row",justifyContent:"space-around"},children:[Object(g.jsx)("div",{style:{fontSize:"1.5em"},children:this.props.track.stop}),Object(g.jsx)("div",{style:{width:"30%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:this.state.etas.map((function(t,e){return Object(g.jsx)("div",{style:{backgroundColor:"lightblue",padding:"2.5px 5px",borderRadius:"7.5px"},children:t},e)}))})]})]})]})}}]),a}(u.a.Component),m=function(t){Object(c.a)(a,t);var e=Object(i.a)(a);function a(t){var n;return Object(s.a)(this,a),(n=e.call(this,t)).state={},n}return Object(r.a)(a,[{key:"render",value:function(){var t=this;return Object(g.jsx)("div",{style:{display:"flex",flexDirection:"column",padding:"10px 0"},children:null!==this.props.tracks?this.props.tracks.map((function(e){return Object(g.jsx)(v,{track:e,removeTrack:t.props.removeTrack},e.created)})):""})}}]),a}(u.a.Component),k=a(35),x=(a(64),function(t){Object(c.a)(a,t);var e=Object(i.a)(a);function a(t){var n;return Object(s.a)(this,a),(n=e.call(this,t)).state={routes:null,stops:null,mappings:null,tracks:null,debug:!1,debugText:"init"},n}return Object(r.a)(a,[{key:"componentDidMount",value:function(){var t=this,e=function(e,a){var n=window.localStorage,s=n.getItem("eta-react-"+e);if(s)console.log("load "+e+" from localStorage"),t.setState(Object(o.a)({},e,JSON.parse(s)));else if(a)console.log("load "+e+" from internet"),function(t){return fetch(t).then((function(t){return t.json()}))}(a).then((function(a){var s=a.data,r={};"routes"===e&&s.forEach((function(t){r[t.route+"&"+t.bound]=t})),"stops"===e&&s.forEach((function(t){r[t.stop]=t})),"mappings"===e&&s.forEach((function(t){r[t.route+"&"+t.bound]||(r[t.route+"&"+t.bound]=[]),r[t.route+"&"+t.bound].push(t)})),n.setItem("eta-react-"+e,JSON.stringify(r)),t.setState(Object(o.a)({},e,r))}));else{console.log("store empty "+e+" to localStorage");var r=[];t.setState(Object(o.a)({},e,r)),n.setItem("eta-react-"+e,JSON.stringify(r))}};e("routes","https://data.etabus.gov.hk/v1/transport/kmb/route/"),e("stops","https://data.etabus.gov.hk/v1/transport/kmb/stop"),e("mappings","https://data.etabus.gov.hk/v1/transport/kmb/route-stop"),e("tracks",null)}},{key:"render",value:function(){var t=this;return Object(g.jsxs)(g.Fragment,{children:[this.state.debug?Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)("pre",{children:this.state.debugText}),Object(g.jsx)("button",{onClick:function(){window.localStorage.clear(),window.location.reload()},children:"DEBUG"}),Object(g.jsx)("button",{onClick:function(){var e,a,n;e=window.localStorage.getItem("eta-react-routes")?JSON.stringify(JSON.parse(window.localStorage.getItem("eta-react-routes"))["968&I"]):"eta-react-routes load error",a=window.localStorage.getItem("eta-react-stops")?JSON.stringify(JSON.parse(window.localStorage.getItem("eta-react-stops")).B7773ED8D2FC08E5):"eta-react-stops load error",n=window.localStorage.getItem("eta-react-mappings")?JSON.stringify(JSON.parse(window.localStorage.getItem("eta-react-mappings"))["968&I"]):"eta-react-mappings load error",t.setState({debugText:e+"\n"+a+"\n"+n})},children:"abc"})]}):Object(g.jsx)(g.Fragment,{}),Object(g.jsxs)("div",{onContextMenu:function(e){t.setState({debug:!t.state.debug})},children:[Object(g.jsx)("code",{children:" Right click (pc)/long press (mobile) track card to remove it "}),Object(g.jsx)("br",{}),Object(g.jsx)("code",{children:" Refresh rate: 10s"})]}),this.state.routes?Object(g.jsx)(O,{addTrack:function(e,a){if(null!==e&&null!==a){var o={created:new Date,route:e.route,orig:e.orig_tc,dest:e.dest_tc,stop:a.name_tc,bound:e.bound,url:"https://data.etabus.gov.hk/v1/transport/kmb/eta/".concat(a.stop,"/").concat(e.route,"/1")},s=!1;t.state.tracks.forEach((function(t){t.url===o.url&&t.bound===o.bound&&(s=!0)})),s?(r="track already exists",k.b.warn(r)):t.setState({tracks:[].concat(Object(n.a)(t.state.tracks),[o])},(function(){window.localStorage.setItem("eta-react-tracks",JSON.stringify(t.state.tracks))}))}var r},routes:this.state.routes,stops:this.state.stops,mappings:this.state.mappings}):"",Object(g.jsx)(m,{tracks:this.state.tracks,removeTrack:function(e){var a,n=JSON.parse(JSON.stringify(t.state.tracks));n.forEach((function(t){t.url===e&&(a=t.route,n.splice(n.indexOf(t),1))})),t.setState({tracks:n},(function(){var e;window.localStorage.setItem("eta-react-tracks",JSON.stringify(t.state.tracks)),e="removed "+a+" track",k.b.info(e)}))}}),Object(g.jsx)(k.a,{position:"bottom-center",autoClose:5e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0})]})}}]),a}(u.a.Component));p.a.render(Object(g.jsx)(x,{}),document.getElementById("root"))}},[[65,1,2]]]);
//# sourceMappingURL=main.a95a7bb5.chunk.js.map